############################################################
# Exploratory_Data_Analysis.R
# Role: EDA Analyst
# Task: Exploratory Data Analysis, Statistical Distributions
#       & Outlier Detection for Netflix Stock Data
############################################################

# ---------------- Step 1: Load Required Libraries ----------------
library(ggplot2)

# ---------------- Step 2: Load Structured Dataset ----------------
netflix <- read.csv("./data/NFLX_structured.csv")

# Ensure correct data types
netflix$Date  <- as.Date(netflix$Date)
netflix$Close <- as.numeric(netflix$Close)

# Remove rows with NA values (generated by rolling features)
netflix <- na.omit(netflix)
netflix


# ---------------- Step 3: Basic Dataset Overview ----------------
str(netflix)
summary(netflix)

# ---------------- Step 4: Time-Series Trend Analysis ----------------
ggplot(netflix, aes(x = Date, y = Close)) +
  geom_line(color = "steelblue", linewidth = 0.6) +
  labs(
    title = "Netflix Closing Price Over Time",
    x = "Date",
    y = "Closing Price"
  ) +
  theme_minimal()

# ---------------- Step 5: Statistical Distribution Analysis ----------------

# Distribution of Closing Prices
ggplot(netflix, aes(x = Close)) +
  geom_histogram(
    bins = 30,
    fill = "skyblue",
    color = "black"
  ) +
  labs(
    title = "Distribution of Netflix Closing Prices",
    x = "Closing Price",
    y = "Frequency"
  ) +
  theme_minimal()

# Distribution of Trading Volume
ggplot(netflix, aes(x = Volume)) +
  geom_histogram(
    bins = 30,
    fill = "orange",
    color = "black"
  ) +
  labs(
    title = "Distribution of Trading Volume",
    x = "Volume",
    y = "Frequency"
  ) +
  theme_minimal()

# ---------------- Step 6: Outlier Detection Using Boxplots ----------------

# Closing Price Outliers
boxplot(
  netflix$Close,
  main = "Boxplot of Closing Price",
  col  = "lightgreen"
)

# Volume Outliers
boxplot(
  netflix$Volume,
  main = "Boxplot of Trading Volume",
  col  = "lightpink"
)


# ---------------- Step 7: Outlier Detection Using IQR Method ----------------

Q1  <- quantile(netflix$Close, 0.25)
Q3  <- quantile(netflix$Close, 0.75)
IQR_value <- Q3 - Q1

lower_bound <- Q1 - 1.5 * IQR_value
upper_bound <- Q3 + 1.5 * IQR_value

outliers_close <- netflix$Close[
  netflix$Close < lower_bound |
    netflix$Close > upper_bound
]

length(outliers_close)

# Note:
# Outliers are retained as they represent real market movements.

# ---------------- Step 8: Volatility Analysis (Daily Returns) ----------------

netflix$Daily_Return <- c(NA, diff(netflix$Close))

ggplot(netflix, aes(x = Date, y = Daily_Return)) +
  geom_line(color = "firebrick", linewidth = 0.5) +
  labs(
    title = "Daily Returns of Netflix Stock",
    x = "Date",
    y = "Daily Return"
  ) +
  theme_minimal()

############################################################
# End of Exploratory Data Analysis Script
############################################################
